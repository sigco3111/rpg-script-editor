
# RPG 스크립트 편집기

RPG 게임의 세계관, 스테이지, 장면, 캐릭터를 만들고 관리하는 데 도움이 되는 웹 애플리케이션입니다. AI(Google Gemini API)를 활용하여 콘텐츠 생성을 지원합니다.

## ✨ 주요 기능

*   **세계관 설정**: 게임의 전반적인 배경, 주요 갈등, 핵심 장소 등을 정의합니다.
*   **스테이지 관리**: 여러 스테이지를 생성하고 각 스테이지의 배경 설명을 편집합니다.
*   **장면 편집**: 각 스테이지 내에 다양한 유형의 장면(나레이션, 대화, 선택지, 전투, 아이템 획득, 장소 변경, 마을)을 만들고 편집합니다.
*   **캐릭터 관리**: 스테이지별로 NPC, 몬스터 등 다양한 유형의 캐릭터를 생성하고 관리합니다.
*   **AI 콘텐츠 생성**:
    *   세계관 설정을 기반으로 스테이지 아이디어 (제목 및 설명) 제안.
    *   스테이지 콘셉트 및 기존 장면들을 바탕으로 전체 스테이지 (캐릭터, 20개 이상의 장면 포함) 자동 생성 (AI 스테이지 마법사).
    *   선택한 장면 유형 및 컨텍스트에 따라 장면 상세 내용 (제목, 내용, 선택지, 적, 보상 등) 생성.
    *   캐릭터 유형 및 컨텍스트에 따라 캐릭터 상세 정보 (이름, 설명, NPC 대화 시드) 생성.
*   **스크립트 플레이어**: 작성된 스테이지를 직접 플레이하며 테스트할 수 있습니다. (전투 반복, 패배 시 마을 귀환, 마을 서비스 기능 포함)
*   **데이터 관리**:
    *   작업 내용을 브라우저 로컬 스토리지에 자동 저장.
    *   프로젝트 전체를 JSON 파일로 내보내기.
    *   JSON 파일에서 프로젝트 가져오기.
*   **반응형 UI**: 다양한 화면 크기에서 사용 가능하도록 설계되었습니다.

## 🛠️ 기술 스택

*   **프론트엔드**: React, TypeScript
*   **스타일링**: Tailwind CSS
*   **AI**: Google Gemini API (`gemini-2.5-flash-preview-04-17` 모델)
*   **상태 관리**: React Hooks (useState, useCallback, useEffect)
*   **모듈 번들러/컴파일러**: (브라우저 내 ES 모듈 로딩 및 esm.sh를 통한 CDN 활용)

## 🚀 시작하기

1.  애플리케이션 파일을 웹 서버에 호스팅하거나 로컬에서 `index.html` 파일을 직접 엽니다.
2.  **API 키 설정 (매우 중요)**:
    AI 기능을 사용하려면 Google Gemini API 키가 필요합니다.
    *   **권장 방법**: 애플리케이션을 실행하는 환경에서 `process.env.API_KEY` 환경 변수를 설정합니다.
        예시 (Node.js 환경): `API_KEY="YOUR_GEMINI_API_KEY" npm start`
    *   **대체 방법**: 만약 환경 변수 설정이 어렵다면, `constants.ts` 파일 내의 `API_KEY` 변수를 직접 수정할 수 있습니다.
        ```typescript
        // constants.ts
        export const API_KEY = typeof process !== 'undefined' && process.env && process.env.API_KEY
            ? process.env.API_KEY
            : "YOUR_GEMINI_API_KEY_HERE"; // "GEMINI_API_키를_여기에_입력하세요" 부분을 실제 키로 변경
        ```
        **주의**: 이 방법은 API 키가 코드에 직접 노출될 수 있으므로, 프로덕션 환경에서는 권장되지 않습니다.

## 📁 프로젝트 구조

```
/
├── public/
│   └── (정적 에셋, 현재는 사용되지 않음)
├── src/
│   ├── components/
│   │   ├── shared/         # 버튼, 모달 등 공용 UI 컴포넌트
│   │   ├── AIStageWizardModal.tsx
│   │   ├── CharacterManagerModal.tsx
│   │   ├── SceneEditorPanel.tsx
│   │   ├── ScriptPlayerModal.tsx
│   │   ├── StageEditorPanel.tsx
│   │   ├── StageListPanel.tsx
│   │   └── WorldSettingsPanel.tsx
│   ├── services/
│   │   ├── geminiService.ts    # Gemini API 연동 로직
│   │   └── localStorageService.ts # 로컬 스토리지 관리
│   ├── utils/
│   │   └── idGenerator.ts      # 고유 ID 생성 유틸
│   ├── App.tsx               # 메인 애플리케이션 컴포넌트
│   ├── constants.ts          # API 키, 모델명 등 상수
│   ├── index.tsx             # React 애플리케이션 진입점
│   └── types.ts              # TypeScript 타입 정의
├── index.html                # 메인 HTML 파일
├── metadata.json             # 애플리케이션 메타데이터
└── README.md                 # 이 파일
```

## 🧩 주요 컴포넌트 및 역할

*   **`App.tsx`**: 애플리케이션의 최상위 컴포넌트로, 전체 상태 관리 및 주요 컴포넌트 레이아웃을 담당합니다. 프로젝트 데이터(세계관, 스테이지, 장면, 캐릭터)를 관리하고, 각 패널/모달 간의 상호작용을 조정합니다.
*   **`WorldSettingsPanel.tsx`**: 사용자가 게임의 전반적인 세계관(제목, 설명, 주요 갈등, 핵심 장소)을 입력하고 수정할 수 있는 UI를 제공합니다.
*   **`StageListPanel.tsx`**: 프로젝트 내 모든 스테이지 목록을 표시합니다. 새 스테이지를 수동으로 추가하거나 AI를 통해 제안받을 수 있으며, 스테이지 삭제 및 선택 기능을 제공합니다. AI 스테이지 마법사를 실행하는 버튼도 포함합니다.
*   **`StageEditorPanel.tsx`**: 선택된 스테이지의 상세 정보(제목, 배경 설명)를 편집하고, 해당 스테이지 내 장면 목록을 관리합니다. 새 장면을 다양한 유형으로 추가하거나 AI로 생성할 수 있으며, 캐릭터 관리 모달을 엽니다.
*   **`SceneEditorPanel.tsx`**: 선택된 장면의 모든 속성(제목, 유형, 내용, 다음 장면 연결, 선택지, 전투 세부 정보 등)을 상세하게 편집합니다. AI를 통해 장면 내용을 생성하거나 개선할 수 있습니다.
*   **`CharacterManagerModal.tsx`**: 특정 스테이지에 등장하는 캐릭터(NPC, 몬스터)를 생성, 편집, 삭제하는 모달입니다. AI를 통해 캐릭터 아이디어를 얻거나 상세 정보를 생성할 수 있습니다.
*   **`AIStageWizardModal.tsx`**: 사용자로부터 스테이지 제목 힌트나 테마를 입력받아 AI를 통해 전체 스테이지(캐릭터, 다수의 장면 포함)를 생성하는 마법사 모달입니다.
*   **`ScriptPlayerModal.tsx`**: 생성된 스테이지를 게임처럼 플레이해볼 수 있는 모달입니다. 장면 전환, 선택지 선택, 전투 결과(승리/패배) 처리, 마을 기능 등을 시뮬레이션합니다.

## 🤖 AI 통합 (Gemini API)

본 애플리케이션은 Google Gemini API를 활용하여 다양한 콘텐츠 생성을 지원합니다. `geminiService.ts` 파일에 관련 로직이 구현되어 있습니다.

*   **스테이지 제안**: 세계관 설정을 기반으로 여러 스테이지의 제목과 간략한 설명을 생성합니다.
*   **장면 상세 생성**: 선택한 장면 유형(나레이션, 대화, 선택지, 전투 등)과 현재 스테이지, 세계관 컨텍스트를 바탕으로 장면의 제목, 내용, 선택지 텍스트, 등장 몬스터 등을 생성합니다.
*   **캐릭터 생성**: 캐릭터 유형(NPC, 몬스터), 스테이지 및 세계관 컨텍스트를 바탕으로 캐릭터의 이름, 설명, NPC의 경우 대화 시드 등을 생성합니다.
*   **AI 스테이지 마법사**: 세계관과 사용자가 제공한 테마(선택 사항)를 기반으로 최소 20개 이상의 장면(마지막은 보스 전투)과 관련 캐릭터를 포함하는 완전한 스테이지를 생성합니다.
*   **주요 모델**: `gemini-2.5-flash-preview-04-17`

API 요청 시 JSON 응답을 기대하며, `responseMimeType: "application/json"` 설정을 사용합니다.

## 💾 데이터 관리

*   **로컬 스토리지**: 사용자의 작업 내용은 `localStorageService.ts`를 통해 브라우저의 로컬 스토리지에 `jrpgProject` 키로 자동 저장됩니다. 이를 통해 사용자가 브라우저를 닫았다가 다시 열어도 작업을 이어갈 수 있습니다.
*   **가져오기/내보내기**:
    *   `내보내기`: 현재 프로젝트 전체를 JSON 형식의 파일로 다운로드할 수 있습니다. 파일 이름은 `(세계관 제목)-프로젝트.json` 형식입니다.
    *   `가져오기`: 로컬에 저장된 프로젝트 JSON 파일을 불러와 현재 작업을 덮어쓸 수 있습니다.

## 🧱 주요 데이터 구조 (`types.ts`)

애플리케이션의 핵심 데이터는 다음과 같은 인터페이스로 정의됩니다:

*   **`Project`**: 전체 프로젝트를 나타내며, `worldSettings`와 `stages` 배열을 포함합니다.
*   **`WorldSettings`**: 게임의 전반적인 배경 설정을 담습니다. (제목, 설명, 주요 갈등, 핵심 장소)
*   **`Stage`**: 개별 스테이지를 나타내며, 제목, 배경 설명, `scenes` 배열, `characters` 배열을 가집니다.
*   **`Scene`**: 스테이지 내의 각 장면을 정의합니다. (ID, 제목, 유형, 내용, 다음 장면 연결, 선택지, 전투 세부정보, 획득 아이템, 새 장소 등)
*   **`Character`**: NPC나 몬스터 등의 캐릭터 정보를 담습니다. (ID, 이름, 유형, 설명, 대화 시드 등)
*   **`SceneType`**: 장면의 유형을 정의하는 열거형입니다. (나레이션, 대화, 선택, 일반 전투, 보스 전투, 아이템 획득, 장소 변경, 마을)
*   **`CharacterType`**: 캐릭터의 유형을 정의하는 열거형입니다. (NPC, 플레이어 캐릭터, 일반 몬스터, 보스 몬스터)

## ✨ UI/UX 하이라이트

*   **직관적인 3단 패널 구조**: 좌측에는 세계관 및 스테이지 목록, 중앙에는 스테이지 편집 및 장면 목록, 우측에는 선택된 항목(세계관, 스테이지, 장면)의 상세 편집 패널이 위치합니다.
*   **모달 기반 상호작용**: 캐릭터 관리, AI 스테이지 마법사, 스크립트 플레이어 등 주요 기능은 모달 창을 통해 제공되어 집중도를 높입니다.
*   **동적 UI 업데이트**: 사용자 입력 및 AI 생성 결과에 따라 UI가 실시간으로 반응하고 업데이트됩니다.
*   **로딩 및 오류 처리**: AI 요청 시 로딩 스피너를 표시하고, 오류 발생 시 사용자에게 알림을 제공합니다.
*   **아이콘 및 버튼**: 명확한 아이콘과 일관된 디자인의 버튼을 사용하여 사용자 편의성을 높였습니다.

## 💡 향후 개선 사항 (제안)

*   **캐릭터 스탯 및 스킬 시스템**: 캐릭터에 구체적인 능력치 및 스킬을 추가하고 전투 시뮬레이션에 반영.
*   **인벤토리 시스템**: 플레이어가 아이템을 획득하고 관리할 수 있는 기능.
*   **퀘스트/플래그 시스템**: 게임 진행에 따른 분기 및 조건부 장면 활성화를 위한 플래그 시스템.
*   **그래픽 요소 추가**: 장면이나 캐릭터에 이미지 업로드 및 표시 기능.
*   **협업 기능**: 여러 사용자가 동시에 스크립트를 편집할 수 있는 기능 (백엔드 필요).
*   **고급 스크립팅**: 간단한 스크립트 언어나 조건문 로직 추가.
*   **다국어 지원**: UI 및 콘텐츠의 다국어 지원.

---

이 RPG 스크립트 편집기를 통해 창의적인 RPG 스토리를 현실로 만들어보세요!
